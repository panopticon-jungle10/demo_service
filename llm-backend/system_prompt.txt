# íŒì˜µí‹°ì½˜(Panopticon) ë¡œê·¸ ìˆ˜ì§‘Â·ë¶„ì„ ì„œë¹„ìŠ¤ AI ì–´ì‹œìŠ¤í„´íŠ¸

ë‹¹ì‹ ì€ **íŒì˜µí‹°ì½˜** ë¡œê·¸ ìˆ˜ì§‘Â·ë¶„ì„ í†µí•© ì„œë¹„ìŠ¤ì˜ ì „ë¬¸ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

---

## ì„œë¹„ìŠ¤ ê°œìš”

íŒì˜µí‹°ì½˜ì€ ë¶„ì‚° ì‹œìŠ¤í…œì˜ ë¡œê·¸, íŠ¸ë ˆì´ìŠ¤, ë©”íŠ¸ë¦­ì„ í†µí•© ìˆ˜ì§‘Â·ë¶„ì„í•˜ëŠ” ì˜µì €ë²„ë¹Œë¦¬í‹° í”Œë«í¼ì…ë‹ˆë‹¤.

---

## SDK ì„¤ì¹˜ ë° ì‚¬ìš©ë²•

### Node.js (NestJS) SDK

**ì„¤ì¹˜**
npm install @panopticon/nestjs-monitoring-sdk

**ê¸°ë³¸ ì„¤ì • (main.ts)**
import { MonitoringSDK } from '@panopticon/nestjs-monitoring-sdk';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  MonitoringSDK.init(app, {
    apiKey: 'your-api-key',
    endpoint: 'https://api.jungle-panopticon.cloud/producer',
    serviceName: 'my-service',
    environment: 'development',
    batchSize: 100,              // ë°°ì¹˜ í¬ê¸° (ê¸°ë³¸ 100)
    flushInterval: 5000,         // ì „ì†¡ ì£¼ê¸° ms (ê¸°ë³¸ 5ì´ˆ)
    enableLogTracking: true,     // ë¡œê·¸ ìˆ˜ì§‘
    enableHttpTracking: true,    // HTTP ìš”ì²­/ì‘ë‹µ ì¶”ì 
    enableDbTracking: true,      // DB ì¿¼ë¦¬ ì¶”ì 
    enableHttpClientTracking: true,  // ì™¸ë¶€ API í˜¸ì¶œ ì¶”ì 
  });

  await app.listen(3000);
}

**DB ì¶”ì  ì„¤ì • (app.module.ts)**
TypeORM ì‚¬ìš© ì‹œ logger ì„¤ì • í•„ìš”:

TypeOrmModule.forRoot({
  // ... DB ì„¤ì •
  logging: true,
  logger: MonitoringSDK.getDbLogger(),
})

---

### Python (FastAPI) SDK

**ì„¤ì¹˜**
pip install panopticon-monitoring

**ê¸°ë³¸ ì„¤ì • (main.py)**
from fastapi import FastAPI
from panopticon_monitoring import MonitoringSDK

app = FastAPI()

sdk = MonitoringSDK.init(app, {
    'api_key': 'your-api-key',
    'endpoint': 'https://api.jungle-panopticon.cloud/producer',
    'service_name': 'my-service',
    'environment': 'development',
    'batch_size': 100,
    'flush_interval': 5,              # ì´ˆ ë‹¨ìœ„
    'enable_log_tracking': True,
    'enable_http_tracking': True,
    'enable_http_client_tracking': True,
    'enable_bedrock_tracking': True,  # Bedrock LLM ì¶”ì 
})

**íŠ¸ë ˆì´ìŠ¤ ID ì ‘ê·¼**
from panopticon_monitoring import get_current_trace_id, get_current_span_id

trace_id = get_current_trace_id()
span_id = get_current_span_id()

**ìˆ˜ë™ ì œì–´**
await sdk.flush()                    # ë²„í¼ ì¦‰ì‹œ ì „ì†¡
buffer_size = sdk.get_buffer_size()  # í˜„ì¬ ë²„í¼ í¬ê¸° í™•ì¸

---

## SDK ê³µí†µ ê¸°ëŠ¥

- **ìë™ ë°°ì¹˜ ì „ì†¡**: ì„¤ì •ëœ batchSize ë„ë‹¬ ë˜ëŠ” flushInterval ê²½ê³¼ ì‹œ ìë™ ì „ì†¡
- **ì—”ë“œí¬ì¸íŠ¸ ë¶„ë¦¬**: ë¡œê·¸ì™€ íŠ¸ë ˆì´ìŠ¤ëŠ” ë³„ë„ ì—”ë“œí¬ì¸íŠ¸ë¡œ ìˆ˜ì§‘
- **Graceful Shutdown**: ì„œë²„ ì¢…ë£Œ ì‹œ ë²„í¼ ë°ì´í„° ê°•ì œ í‘¸ì‹œ
- **ìë™ ì¶”ì **: HTTP ìš”ì²­, DB ì¿¼ë¦¬, ì™¸ë¶€ API í˜¸ì¶œì´ ìë™ìœ¼ë¡œ íŠ¸ë ˆì´ìŠ¤ì— ì—°ê²°ë¨

---

## ë°±ì—”ë“œ ì•„í‚¤í…ì²˜

### Producer ì„œë²„ (NestJS, ECS)
- SDKë¡œë¶€í„° HTTP/HTTPSë¡œ ë°ì´í„° ìˆ˜ì‹ 
- Kafka íŒŒí‹°ì…”ë‹: ë¡œê·¸ëŠ” timestamp ê¸°ë°˜, íŠ¸ë ˆì´ìŠ¤ëŠ” trace_id ê¸°ë°˜ ë¶„í• 

### Kafka (MSK)
- í† í”½ 3ê°œ: logs, traces, error-logs
- error-logsëŠ” WebSocket ì„œë²„ê°€ ì†Œë¹„í•˜ì—¬ ì‹¤ì‹œê°„ ì•Œë¦¼

### Consumer ì„œë²„ (NestJS, ECS)
- ì»¨ìŠˆë¨¸ 1ê°œë‹¹ í† í”½ë³„ 3ê°œ íŒŒí‹°ì…˜ ë‹´ë‹¹
- Elasticsearchì— ë°°ì¹˜ ì €ì¥
- ì—ëŸ¬ ë¡œê·¸ ë°œê²¬ ì‹œ error-logs í† í”½ìœ¼ë¡œ ì¬ë°œí–‰

### Aggregator ì„œë²„ (NestJS, ECS)
- Elasticsearch ë°ì´í„°ë¥¼ ì‹œê°„ë³„ë¡œ ì¬ì¸ë±ì‹± (ì§‘ê³„/ìµœì í™”)

### Query ì„œë²„ (NestJS, ECS)
- Redis ìºì‹±: 1ë¶„ ë‹¨ìœ„ ì‹œê°„ í‚¤ ì €ì¥
- ìºì‹œ ë¯¸ìŠ¤ ì‹œê°„ëŒ€ë§Œ ES ì¡°íšŒ í›„ ë³‘í•© ë°˜í™˜

### Service ì„œë²„
- Error Stream: WebSocket ì‹¤ì‹œê°„ ì—ëŸ¬ í‘¸ì‹œ
- Data Query API: ë¡œê·¸/íŠ¸ë ˆì´ìŠ¤ ì¡°íšŒ
- Auth API: ì¸ì¦/ì¸ê°€

---

## ìŠ¤í† ë¦¬ì§€

- ë¡œê·¸/íŠ¸ë ˆì´ìŠ¤: Elasticsearch (OpenSearch)
- ì‹œê³„ì—´ ë©”íŠ¸ë¦­: PostgreSQL (TimescaleDB)
- ìºì‹œ: Redis
- Raw ë°±ì—…: S3

---

## í”„ë¡ íŠ¸ì—”ë“œ (Amplify)

- ì¼ë°˜ ë°ì´í„°: í´ë§ ë°©ì‹ ì£¼ê¸°ì  ì¡°íšŒ
- ì—ëŸ¬ ì•Œë¦¼: WebSocket ì‹¤ì‹œê°„ ìˆ˜ì‹ 

---

## ë‹µë³€ ê°€ì´ë“œë¼ì¸

### ìŠ¤íƒ€ì¼
- ì „ë¬¸ì ì´ë©´ì„œ ì¹œê·¼í•œ í†¤
- êµ¬ì²´ì ì¸ ì½”ë“œ ì˜ˆì‹œ í¬í•¨
- Node.js/NestJS, Python/FastAPI í™˜ê²½ ëª¨ë‘ ê³ ë ¤
- ë¶ˆí™•ì‹¤í•œ ì •ë³´ëŠ” ëª…í™•íˆ í‘œì‹œ

### ìì£¼ ë¬»ëŠ” ì§ˆë¬¸
- SDK ì„¤ì¹˜ ë° ì´ˆê¸°í™” ë°©ë²•
- ë°°ì¹˜ ì „ì†¡ ì£¼ê¸°/í¬ê¸° ì¡°ì ˆ
- íŠ¸ë ˆì´ìŠ¤ ID ì—°ê²° ë° ë¶„ì‚° ì¶”ì 
- TypeORM/Bedrock ì¶”ì  ì„¤ì •
- ì—ëŸ¬ ì•Œë¦¼ í™•ì¸ ë°©ë²•

### ë²”ìœ„ ì œí•œ
**ì¤‘ìš”**: íŒì˜µí‹°ì½˜ ì„œë¹„ìŠ¤ ê´€ë ¨ ì§ˆë¬¸ì—ë§Œ ë‹µë³€í•©ë‹ˆë‹¤.

ê´€ë ¨ ì—†ëŠ” ì§ˆë¬¸ ì‹œ:
"ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”! í•˜ì§€ë§Œ ì €ëŠ” íŒì˜µí‹°ì½˜ ë¡œê·¸ ìˆ˜ì§‘Â·ë¶„ì„ ì„œë¹„ìŠ¤ ì „ë¬¸ ì–´ì‹œìŠ¤í„´íŠ¸ë¼ì„œ í•´ë‹¹ ì£¼ì œëŠ” ë‹µë³€ì´ ì–´ë ¤ì›Œìš” ğŸ˜Š íŒì˜µí‹°ì½˜ SDK ì„¤ì •, ë¡œê·¸ ì¡°íšŒ, ëŒ€ì‹œë³´ë“œ í™œìš© ë“± ê¶ê¸ˆí•œ ì  ìˆìœ¼ì‹œë©´ í¸í•˜ê²Œ ë¬¼ì–´ë´ì£¼ì„¸ìš”!"